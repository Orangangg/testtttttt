//Привязка фото к варианту товара

const SELECTORS={container:".t-store__prod-snippet__container",slideItems:".t-slds__item",sliderContainer:".t-slds__container",itemsWrapper:".t-slds__items-wrapper",thumbsWrapper:".t-slds__thumbsbullet-wrapper",volumeOptions:".t-product__option-input"};let slides={};function updateSliderImages(e,t=!1){const s=slides[e],i=document.querySelector(SELECTORS.itemsWrapper),l=document.querySelector(SELECTORS.thumbsWrapper),o=document.querySelector(".t-slds__main");if(!i)return void console.error("Элемент wrapper не найден");const r=o.offsetHeight,n=o.offsetWidth;t||(o.style.height=`${r}px`,o.style.width=`${n}px`,o.style.overflow="hidden"),i.innerHTML="",l&&(l.innerHTML=""),(null==s?void 0:s.length)>0&&(()=>{const e=s[s.length-1],r=document.createElement("div");if(r.classList.add("t-slds__item","t-slds__item-loaded"),r.setAttribute("data-slide-index",0),r.setAttribute("aria-hidden",!0),r.innerHTML=`<div class="t-slds__wrapper"><div class="t-slds__imgwrapper t-zoomable" data-zoom-target="0" data-img-zoom-url="${e}" data-zoomable="yes"><div class="t-slds__bgimg t-bgimg" data-original="${e}" style="padding-bottom: 100%; background-image: url('${e}');"></div></div></div>`,i.appendChild(r),s.forEach((e,r)=>{const n=document.createElement("div");if(n.classList.add("t-slds__item","t-slds__item-loaded"),n.setAttribute("data-slide-index",r+1),0===r&&n.classList.add("t-slds__item_active"),n.innerHTML=`<div class="t-slds__wrapper"><div class="t-slds__imgwrapper t-zoomable" data-zoom-target="${r+1}" data-img-zoom-url="${e}" data-zoomable="yes"><div class="t-slds__bgimg t-bgimg" data-original="${e}" style="padding-bottom: 100%; background-image: url('${e}');"></div></div></div>`,i.appendChild(n),l){const t=document.createElement("div");t.classList.add("t-slds__thumbsbullet","t-slds__bullet"),t.setAttribute("data-slide-bullet-for",r+1),0===r&&t.classList.add("t-slds__bullet_active"),t.innerHTML=`<div class="t-slds__bgimg t-bgimg" data-original="${e}" style="padding-bottom: 100%; background-image: url('${e}');"></div><div class="t-slds__thumbsbullet-border"></div>`,l.appendChild(t)}}),(()=>{const e=s[0],l=document.createElement("div");l.classList.add("t-slds__item","t-slds__item-loaded"),l.setAttribute("data-slide-index",s.length+1),l.setAttribute("aria-hidden",!0),l.innerHTML=`<div class="t-slds__wrapper"><div class="t-slds__imgwrapper t-zoomable" data-zoom-target="${s.length+1}" data-img-zoom-url="${e}" data-zoomable="yes"><div class="t-slds__bgimg t-bgimg" data-original="${e}" style="padding-bottom: 100%; background-image: url('${e}');"></div></div></div>`,i.appendChild(l)})(),i.setAttribute("data-slider-totalslides",s.length),i.setAttribute("data-slider-pos",1),t||(i.style.transform="translateX(-800px)"),t||setTimeout(()=>{o.style.height="",o.style.width="",o.style.overflow=""},100)})()}function isDOMReady(){return"complete"===document.readyState||"interactive"===document.readyState}function initializeWithRetry(e=5,t=1e3){let s=0;function i(){if(s++,console.log(`Попытка инициализации ${s}`),!function(){const e=document.querySelector(SELECTORS.container),t=document.querySelectorAll(SELECTORS.slideItems),s=document.querySelector(SELECTORS.itemsWrapper);return!!(e&&t.length&&s)}())return s<e?(console.log("Элементы не найдены, повторная попытка..."),void setTimeout(i,t)):(console.error("Превышено максимальное количество попыток инициализации"),void 0);try{const t=document.querySelector(SELECTORS.container).parentNode?.getAttribute("id");if(!t)throw new Error("ID родительского элемента не найден");const l=t.replace(/\D/g,"");if(slides={},document.querySelectorAll(SELECTORS.slideItems).forEach(e=>{const t=e.querySelector('meta[itemprop="caption"]')?.getAttribute("content"),s=e.querySelector('meta[itemprop="image"]')?.getAttribute("content");t&&s&&(slides[t]||(slides[t]=[]),slides[t].includes(s)||slides[t].push(s))}),0===Object.keys(slides).length)throw new Error("Не удалось собрать информацию о слайдах");document.querySelectorAll(SELECTORS.volumeOptions).forEach(e=>{e.addEventListener("change",function(){this.checked&&(updateSliderImages(this.value,!1),"function"==typeof t_slds_updateSlider&&t_slds_updateSlider(l))})});const o=document.querySelector(`${SELECTORS.volumeOptions}:checked`);o&&(updateSliderImages(o.value,!0),"function"==typeof t_slds_updateSlider&&t_slds_updateSlider(l)),window.updateSliderImages=updateSliderImages,console.log("Инициализация успешно завершена")}catch(l){console.error("Ошибка инициализации слайдера:",l.message),s<e&&setTimeout(i,t)}}isDOMReady()?i():document.addEventListener("DOMContentLoaded",i)}window.addEventListener("load",function(){initializeWithRetry()}),isDOMReady()&&initializeWithRetry();